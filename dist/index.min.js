"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var util_1=require("./util"),Tuex=function(){function t(t,e){var o=this;this._eventPool={value:[],getter:[],setter:[],action:[],global:[]};this._strict=!1;this.store=null;var r=e||{strict:!1,plugins:[]},i=r.strict,n=r.plugins;this._strict=i;this.replaceStore(t);n&&n.forEach(function(t){return t.apply(o)})}t.prototype._storeEvent=function(t,e,o){for(var r=[],i=3;i<arguments.length;i++)r[i-3]=arguments[i];this._eventPool[t].forEach(function(t){return t.apply(void 0,[e,o].concat(r))})};t.prototype.subscribe=function(t,e){var o=this;this._eventPool[t].push(e);return function(){o._eventPool[t]=o._eventPool[t].filter(function(t){return t!=e}).slice()}};t.prototype.replaceStore=function(t){var e;if(util_1.isFunction(t))try{e=new t}catch(o){e=t()}else e=t;this.store=this.objectToStore(e,t);this._vue&&(this._vue.prototype.$store=this.store)};t.prototype.objectToStore=function(t,e){var o=this,r=this,i={},n=[].concat(util_1.keysOf(t));util_1.isFunction(e)&&n.push.apply(n,util_1.keysOf(e.prototype));for(var s=this,l=0,u=n;l<u.length;l++){var c=u[l];!function(n){var l=function(t){return Object.defineProperty(i,n,t)},u=util_1.desc(t,n)||util_1.desc(e.prototype,n);if(util_1.isFunction(t[n]))l({configurable:!1,enumerable:!1,writable:!1,value:function(){(e=r._storeEvent).call.apply(e,[r,"action",t,n].concat([].concat(arguments)));return t[n].apply(i,arguments);var e}});else if(util_1.isValue(u)){var c=util_1.isObject(t[n]);c&&(t[n]=s.objectToStore(t[n],void 0));l({configurable:!1,enumerable:!0,get:function(){r._storeEvent.call(r,"value",t,n);return t[n]},set:r._strict?function(){"production"!==process.env.NODE_ENV&&console.error("Explicit mutations of store values are prohibited!\nPlease, use setters instead or disable the [immutableState] flag!")}:function(e){r._storeEvent.call(r,"global",t,n,e);r._storeEvent.call(r,"value",t,n,e);t[n]=c?o.objectToStore(e,void 0):e}})}else util_1.isGetter(u)?l({configurable:!1,enumerable:!1,get:function(){r._storeEvent.call(r,"getter",t,n);return t[n]}}):util_1.isSetter(u)?l({configurable:!1,enumerable:!1,set:function(e){r._storeEvent.call(r,"global",t,n,e);r._storeEvent.call(r,"setter",t,n,e);t[n]=e}}):"production"!==process.env.NODE_ENV&&console.error("Descriptor of "+n+" is wrong!")}(c)}return i};t.prototype.install=function(t){if(this._vue&&t===this._vue)"production"!==process.env.NODE_ENV&&console.error("[tuex] is already installed. Vue.use(new Tuex(...)) should be called only once.");else{this._vue=t;this._vue.prototype.$store=this.store}};return t}();exports.default=Tuex;