const e=Object.getOwnPropertyDescriptor,t=Object.getOwnPropertyNames;function o(e){return!!e&&(e instanceof Function||"function"==typeof e)}export default class Tuex{constructor(e,t){this._eventPool={value:[],getter:[],setter:[],action:[],global:[]};this._strict=!1;this.store=null;const{strict:o,plugins:r}=t||{strict:!1,plugins:[]};this._strict=o;this.replaceStore(e);r&&r.forEach(e=>e.apply(this))}_storeEvent(e,t,o,...r){this._eventPool[e].forEach(e=>e(t,o,...r))}subscribe(e,t){this._eventPool[e].push(t);return()=>{this._eventPool[e]=[...this._eventPool[e].filter(e=>e!=t)]}}replaceStore(e){let t;if(o(e)){try{t=new e}catch(o){t=e()}this.store=this.objectToStore(t,e)}else{t=e;this.store=this.objectToStore(t)}this._vue&&(this._vue.prototype.$store=this.store)}objectToStore(r,s){const i={},n=[].concat(t(r));o(s)&&n.push(...t(s.prototype));for(let t of n){const n=e=>Object.defineProperty(i,t,e),p=e(r,t)||e(s.prototype,t),h=(e,...o)=>this._storeEvent.call(this,e,r,t,...o);if(o(r[t]))n({configurable:!1,enumerable:!1,writable:!1,value:function(){h("action",...[].concat(arguments));return r[t].apply(i,arguments)}});else if(a=p,!a||o(a.value)||a.get||a.set)l=p,l&&l.get&&!l.set?n({configurable:!1,enumerable:!1,get:()=>{h("getter");return r[t]}}):(c=p,c&&!c.get&&c.set?n({configurable:!1,enumerable:!1,set:e=>{h("global",e);h("setter",e);r[t]=e}}):"production"!==process.env.NODE_ENV&&console.error("Descriptor of "+t+" is wrong!"));else{const e=!!(u=r[t])&&"[object Object]"===Object.prototype.toString.apply(u);e&&(r[t]=this.objectToStore(r[t]));n({configurable:!1,enumerable:!0,get:()=>{h("value");return r[t]},set:this._strict?()=>{"production"!==process.env.NODE_ENV&&console.error("Explicit mutations of store values are prohibited!\nPlease, use setters instead or disable the [strict] flag!")}:o=>{h("global",o);h("value",o);r[t]=e?this.objectToStore(o):o}})}}var c,l,u,a;return i}install(e){if(this._vue&&e===this._vue)"production"!==process.env.NODE_ENV&&console.error("[tuex] is already installed. Vue.use(new Tuex(...)) should be called only once.");else{this._vue=e;this._vue.prototype.$store=this.store}}};